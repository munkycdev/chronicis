<?xml version="1.0" encoding="utf-8"?>
<CoverageReport scope="Chronicis.Api.Services.PromptService">
  <Summary>
    <Class>Chronicis.Api.Services.PromptService</Class>
    <Assembly>Chronicis.Api</Assembly>
    <Files>
      <File>Z:\repos\chronicis\src\Chronicis.Api\Services\PromptService.cs</File>
    </Files>
    <Coveredlines>212</Coveredlines>
    <Uncoveredlines>0</Uncoveredlines>
    <Coverablelines>212</Coverablelines>
    <Totallines>283</Totallines>
    <Linecoverage>100</Linecoverage>
    <Coveredbranches>38</Coveredbranches>
    <Totalbranches>38</Totalbranches>
    <Branchcoverage>100</Branchcoverage>
    <Coveredmethods>7</Coveredmethods>
    <Fullcoveredmethods>7</Fullcoveredmethods>
    <Totalmethods>7</Totalmethods>
    <Methodcoverage>100</Methodcoverage>
    <Fullmethodcoverage>100</Fullmethodcoverage>
  </Summary>
  <Metrics>
    <Element name="ctor">
      <CrapScore>1</CrapScore>
      <Cyclomaticcomplexity>1</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="GeneratePrompts">
      <CrapScore>1</CrapScore>
      <Cyclomaticcomplexity>1</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="AddMissingFundamentalPrompts">
      <CrapScore>10</CrapScore>
      <Cyclomaticcomplexity>10</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="AddStaleContentPrompts">
      <CrapScore>4</CrapScore>
      <Cyclomaticcomplexity>4</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="AddSessionFollowUpPrompts">
      <CrapScore>12</CrapScore>
      <Cyclomaticcomplexity>12</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="AddEngagementPrompts">
      <CrapScore>6</CrapScore>
      <Cyclomaticcomplexity>6</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="AddGeneralTips">
      <CrapScore>6</CrapScore>
      <Cyclomaticcomplexity>6</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
  </Metrics>
  <Files>
    <File name="Z:\repos\chronicis\src\Chronicis.Api\Services\PromptService.cs">
      <LineAnalysis line="1" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="using Chronicis.Shared.DTOs;" />
      <LineAnalysis line="2" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="3" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="namespace Chronicis.Api.Services;" />
      <LineAnalysis line="4" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="5" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="/// &lt;summary&gt;" />
      <LineAnalysis line="6" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="/// Service for generating contextual prompts based on user state." />
      <LineAnalysis line="7" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="/// &lt;/summary&gt;" />
      <LineAnalysis line="8" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="public class PromptService : IPromptService" />
      <LineAnalysis line="9" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="{" />
      <LineAnalysis line="10" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private readonly ILogger&lt;PromptService&gt; _logger;" />
      <LineAnalysis line="11" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="12" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    // Configuration constants" />
      <LineAnalysis line="13" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private const int StaleCharacterDays = 14;" />
      <LineAnalysis line="14" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private const int SessionFollowUpDays = 7;" />
      <LineAnalysis line="15" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private const int MaxPrompts = 3;" />
      <LineAnalysis line="16" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="17" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    public PromptService(ILogger&lt;PromptService&gt; logger)" />
      <LineAnalysis line="18" visits="17" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="19" visits="17" coverage="Covered" coveredbranches="" totalbranches="" content="        _logger = logger;" />
      <LineAnalysis line="20" visits="17" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="21" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="22" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    public List&lt;PromptDto&gt; GeneratePrompts(DashboardDto dashboard)" />
      <LineAnalysis line="23" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="24" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        var prompts = new List&lt;PromptDto&gt;();" />
      <LineAnalysis line="25" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="26" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Priority 1: Missing fundamentals" />
      <LineAnalysis line="27" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        AddMissingFundamentalPrompts(dashboard, prompts);" />
      <LineAnalysis line="28" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="29" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Priority 2: Stale content needing attention" />
      <LineAnalysis line="30" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        AddStaleContentPrompts(dashboard, prompts);" />
      <LineAnalysis line="31" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="32" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Priority 3: Session follow-up" />
      <LineAnalysis line="33" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        AddSessionFollowUpPrompts(dashboard, prompts);" />
      <LineAnalysis line="34" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="35" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Priority 4: Engagement suggestions" />
      <LineAnalysis line="36" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        AddEngagementPrompts(dashboard, prompts);" />
      <LineAnalysis line="37" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="38" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Priority 5: General tips (fallback)" />
      <LineAnalysis line="39" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        AddGeneralTips(dashboard, prompts);" />
      <LineAnalysis line="40" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="41" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Return top N prompts by priority" />
      <LineAnalysis line="42" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        return prompts" />
      <LineAnalysis line="43" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            .OrderBy(p =&gt; p.Priority)" />
      <LineAnalysis line="44" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            .Take(MaxPrompts)" />
      <LineAnalysis line="45" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            .ToList();" />
      <LineAnalysis line="46" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="47" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="48" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private void AddMissingFundamentalPrompts(DashboardDto dashboard, List&lt;PromptDto&gt; prompts)" />
      <LineAnalysis line="49" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="50" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // No worlds at all" />
      <LineAnalysis line="51" visits="16" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (!dashboard.Worlds.Any())" />
      <LineAnalysis line="52" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="53" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            prompts.Add(new PromptDto" />
      <LineAnalysis line="54" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="55" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Key = &quot;no-worlds&quot;," />
      <LineAnalysis line="56" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Title = &quot;Create Your First World&quot;," />
      <LineAnalysis line="57" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Message = &quot;Every great campaign starts with a world. Create one to begin organizing your adventures.&quot;," />
      <LineAnalysis line="58" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Icon = &quot;ðŸŒ&quot;," />
      <LineAnalysis line="59" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                ActionText = &quot;Create World&quot;," />
      <LineAnalysis line="60" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                ActionUrl = &quot;/dashboard&quot;, // Dashboard has the create button" />
      <LineAnalysis line="61" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Priority = 10," />
      <LineAnalysis line="62" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Category = PromptCategory.MissingFundamental" />
      <LineAnalysis line="63" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            });" />
      <LineAnalysis line="64" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            return; // Don't add more prompts if no worlds" />
      <LineAnalysis line="65" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="66" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="67" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Has world but no campaigns" />
      <LineAnalysis line="68" visits="15" coverage="Covered" coveredbranches="" totalbranches="" content="        var worldsWithoutCampaigns = dashboard.Worlds.Where(w =&gt; !w.Campaigns.Any()).ToList();" />
      <LineAnalysis line="69" visits="15" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (worldsWithoutCampaigns.Any())" />
      <LineAnalysis line="70" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="71" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            var world = worldsWithoutCampaigns.First();" />
      <LineAnalysis line="72" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            prompts.Add(new PromptDto" />
      <LineAnalysis line="73" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="74" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Key = $&quot;no-campaign-{world.Id}&quot;," />
      <LineAnalysis line="75" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Title = &quot;Start a Campaign&quot;," />
      <LineAnalysis line="76" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Message = $&quot;Your world \&quot;{world.Name}\&quot; doesn't have any campaigns yet. Create one to track your adventures!&quot;," />
      <LineAnalysis line="77" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Icon = &quot;ðŸ“œ&quot;," />
      <LineAnalysis line="78" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                ActionText = &quot;View World&quot;," />
      <LineAnalysis line="79" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                ActionUrl = $&quot;/world/{world.Slug}&quot;," />
      <LineAnalysis line="80" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Priority = 20," />
      <LineAnalysis line="81" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Category = PromptCategory.MissingFundamental" />
      <LineAnalysis line="82" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            });" />
      <LineAnalysis line="83" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="84" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="85" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Has campaigns but no claimed characters" />
      <LineAnalysis line="86" visits="15" coverage="Covered" coveredbranches="4" totalbranches="4" content="        if (!dashboard.ClaimedCharacters.Any() &amp;&amp; dashboard.Worlds.Any(w =&gt; w.Campaigns.Any()))" />
      <LineAnalysis line="87" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="88" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            prompts.Add(new PromptDto" />
      <LineAnalysis line="89" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="90" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="                Key = &quot;no-characters&quot;," />
      <LineAnalysis line="91" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="                Title = &quot;Claim Your Character&quot;," />
      <LineAnalysis line="92" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="                Message = &quot;You haven't claimed any characters yet. Find your character in the tree and click 'Claim as My Character' to see them on your dashboard.&quot;," />
      <LineAnalysis line="93" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="                Icon = &quot;ðŸ‘¤&quot;," />
      <LineAnalysis line="94" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="                Priority = 30," />
      <LineAnalysis line="95" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="                Category = PromptCategory.MissingFundamental" />
      <LineAnalysis line="96" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            });" />
      <LineAnalysis line="97" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="98" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="99" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Has campaign but no sessions" />
      <LineAnalysis line="100" visits="15" coverage="Covered" coveredbranches="" totalbranches="" content="        var campaignsWithoutSessions = dashboard.Worlds" />
      <LineAnalysis line="101" visits="15" coverage="Covered" coveredbranches="" totalbranches="" content="            .SelectMany(w =&gt; w.Campaigns)" />
      <LineAnalysis line="102" visits="15" coverage="Covered" coveredbranches="" totalbranches="" content="            .Where(c =&gt; c.SessionCount == 0)" />
      <LineAnalysis line="103" visits="15" coverage="Covered" coveredbranches="" totalbranches="" content="            .ToList();" />
      <LineAnalysis line="104" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="105" visits="15" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (campaignsWithoutSessions.Any())" />
      <LineAnalysis line="106" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="107" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            var campaign = campaignsWithoutSessions.First();" />
      <LineAnalysis line="108" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            var world = dashboard.Worlds.First(w =&gt; w.Campaigns.Contains(campaign));" />
      <LineAnalysis line="109" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            prompts.Add(new PromptDto" />
      <LineAnalysis line="110" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="111" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Key = $&quot;no-sessions-{campaign.Id}&quot;," />
      <LineAnalysis line="112" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Title = &quot;Record Your First Session&quot;," />
      <LineAnalysis line="113" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Message = $&quot;Campaign \&quot;{campaign.Name}\&quot; has no session notes yet. Start documenting your adventures!&quot;," />
      <LineAnalysis line="114" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Icon = &quot;ðŸ“&quot;," />
      <LineAnalysis line="115" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                ActionText = &quot;Add Session&quot;," />
      <LineAnalysis line="116" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                ActionUrl = $&quot;/world/{world.Slug}&quot;," />
      <LineAnalysis line="117" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Priority = 40," />
      <LineAnalysis line="118" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Category = PromptCategory.MissingFundamental" />
      <LineAnalysis line="119" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            });" />
      <LineAnalysis line="120" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="121" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="122" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="123" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private void AddStaleContentPrompts(DashboardDto dashboard, List&lt;PromptDto&gt; prompts)" />
      <LineAnalysis line="124" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="125" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        var staleThreshold = DateTime.UtcNow.AddDays(-StaleCharacterDays);" />
      <LineAnalysis line="126" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="127" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Stale characters (not updated in 14+ days)" />
      <LineAnalysis line="128" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        var staleCharacters = dashboard.ClaimedCharacters" />
      <LineAnalysis line="129" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            .Where(c =&gt; (c.ModifiedAt ?? c.CreatedAt) &lt; staleThreshold)" />
      <LineAnalysis line="130" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            .OrderBy(c =&gt; c.ModifiedAt ?? c.CreatedAt)" />
      <LineAnalysis line="131" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            .ToList();" />
      <LineAnalysis line="132" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="133" visits="16" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (staleCharacters.Any())" />
      <LineAnalysis line="134" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="135" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            var stalest = staleCharacters.First();" />
      <LineAnalysis line="136" visits="2" coverage="Covered" coveredbranches="2" totalbranches="2" content="            var daysSinceUpdate = (int)(DateTime.UtcNow - (stalest.ModifiedAt ?? stalest.CreatedAt)).TotalDays;" />
      <LineAnalysis line="137" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="138" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            prompts.Add(new PromptDto" />
      <LineAnalysis line="139" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="140" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Key = $&quot;stale-character-{stalest.Id}&quot;," />
      <LineAnalysis line="141" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Title = &quot;Update Your Character&quot;," />
      <LineAnalysis line="142" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Message = $&quot;\&quot;{stalest.Title}\&quot; hasn't been updated in {daysSinceUpdate} days. How have they grown since your last session?&quot;," />
      <LineAnalysis line="143" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Icon = &quot;âœ¨&quot;," />
      <LineAnalysis line="144" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                ActionText = &quot;View Character&quot;," />
      <LineAnalysis line="145" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                ActionUrl = $&quot;/article/{stalest.Id}&quot;," />
      <LineAnalysis line="146" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Priority = 50," />
      <LineAnalysis line="147" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Category = PromptCategory.NeedsAttention" />
      <LineAnalysis line="148" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            });" />
      <LineAnalysis line="149" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="150" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="151" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="152" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private void AddSessionFollowUpPrompts(DashboardDto dashboard, List&lt;PromptDto&gt; prompts)" />
      <LineAnalysis line="153" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="154" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        var followUpThreshold = DateTime.UtcNow.AddDays(-SessionFollowUpDays);" />
      <LineAnalysis line="155" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="156" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Find campaigns with recent sessions that might need follow-up notes" />
      <LineAnalysis line="157" visits="78" coverage="Covered" coveredbranches="2" totalbranches="2" content="        foreach (var world in dashboard.Worlds)" />
      <LineAnalysis line="158" visits="15" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="159" visits="54" coverage="Covered" coveredbranches="2" totalbranches="2" content="            foreach (var campaign in world.Campaigns.Where(c =&gt; c.IsActive))" />
      <LineAnalysis line="160" visits="5" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="161" visits="5" coverage="Covered" coveredbranches="2" totalbranches="2" content="                var latestSessionDate = campaign.CurrentArc?.LatestSessionDate;" />
      <LineAnalysis line="162" visits="5" coverage="Covered" coveredbranches="2" totalbranches="2" content="                if (latestSessionDate.HasValue)" />
      <LineAnalysis line="163" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="                {" />
      <LineAnalysis line="164" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="                    var lastSession = latestSessionDate.Value;" />
      <LineAnalysis line="165" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="                    var daysSinceSession = (int)(DateTime.UtcNow - lastSession).TotalDays;" />
      <LineAnalysis line="166" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="167" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                    // Session was 2-7 days ago - good time to add notes while fresh" />
      <LineAnalysis line="168" visits="3" coverage="Covered" coveredbranches="4" totalbranches="4" content="                    if (daysSinceSession &gt;= 2 &amp;&amp; daysSinceSession &lt;= SessionFollowUpDays)" />
      <LineAnalysis line="169" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                    {" />
      <LineAnalysis line="170" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                        prompts.Add(new PromptDto" />
      <LineAnalysis line="171" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                        {" />
      <LineAnalysis line="172" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                            Key = $&quot;session-followup-{campaign.Id}&quot;," />
      <LineAnalysis line="173" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                            Title = &quot;Add Session Notes&quot;," />
      <LineAnalysis line="174" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                            Message = $&quot;Your last session in \&quot;{campaign.Name}\&quot; was {daysSinceSession} days ago. Add notes while it's still fresh!&quot;," />
      <LineAnalysis line="175" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                            Icon = &quot;ðŸ“–&quot;," />
      <LineAnalysis line="176" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                            ActionText = &quot;View Campaign&quot;," />
      <LineAnalysis line="177" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                            ActionUrl = $&quot;/world/{world.Slug}&quot;," />
      <LineAnalysis line="178" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                            Priority = 60," />
      <LineAnalysis line="179" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                            Category = PromptCategory.NeedsAttention" />
      <LineAnalysis line="180" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                        });" />
      <LineAnalysis line="181" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                        break; // Only one session follow-up prompt" />
      <LineAnalysis line="182" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                    }" />
      <LineAnalysis line="183" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                }" />
      <LineAnalysis line="184" visits="4" coverage="Covered" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="185" visits="15" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="186" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="187" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="188" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private void AddEngagementPrompts(DashboardDto dashboard, List&lt;PromptDto&gt; prompts)" />
      <LineAnalysis line="189" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="190" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Only add engagement prompts if user has some content" />
      <LineAnalysis line="191" visits="16" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (!dashboard.Worlds.Any())" />
      <LineAnalysis line="192" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            return;" />
      <LineAnalysis line="193" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="194" visits="15" coverage="Covered" coveredbranches="" totalbranches="" content="        var totalArticles = dashboard.Worlds.Sum(w =&gt; w.ArticleCount);" />
      <LineAnalysis line="195" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="196" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Suggest wiki links if they have multiple articles" />
      <LineAnalysis line="197" visits="15" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (totalArticles &gt;= 5)" />
      <LineAnalysis line="198" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="199" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            prompts.Add(new PromptDto" />
      <LineAnalysis line="200" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="201" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Key = &quot;try-wiki-links&quot;," />
      <LineAnalysis line="202" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Title = &quot;Connect Your Content&quot;," />
      <LineAnalysis line="203" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Message = &quot;Use [[Article Name]] in your notes to create links between articles. It's a great way to build a connected knowledge base!&quot;," />
      <LineAnalysis line="204" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Icon = &quot;ðŸ”—&quot;," />
      <LineAnalysis line="205" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Priority = 70," />
      <LineAnalysis line="206" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="                Category = PromptCategory.Suggestion" />
      <LineAnalysis line="207" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            });" />
      <LineAnalysis line="208" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="209" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="210" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Suggest AI summaries if they have backlinks" />
      <LineAnalysis line="211" visits="15" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (totalArticles &gt;= 10)" />
      <LineAnalysis line="212" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="213" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            prompts.Add(new PromptDto" />
      <LineAnalysis line="214" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="215" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Key = &quot;try-ai-summaries&quot;," />
      <LineAnalysis line="216" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Title = &quot;Try AI Summaries&quot;," />
      <LineAnalysis line="217" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Message = &quot;Articles with backlinks can generate AI summaries. Open an article and click 'Generate Summary' to try it out!&quot;," />
      <LineAnalysis line="218" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Icon = &quot;ðŸ¤–&quot;," />
      <LineAnalysis line="219" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Priority = 75," />
      <LineAnalysis line="220" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Category = PromptCategory.Suggestion" />
      <LineAnalysis line="221" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            });" />
      <LineAnalysis line="222" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="223" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="224" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="225" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private void AddGeneralTips(DashboardDto dashboard, List&lt;PromptDto&gt; prompts)" />
      <LineAnalysis line="226" visits="17" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="227" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Only add tips if we don't have enough higher-priority prompts" />
      <LineAnalysis line="228" visits="17" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (prompts.Count &gt;= MaxPrompts)" />
      <LineAnalysis line="229" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            return;" />
      <LineAnalysis line="230" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="231" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        var tips = new List&lt;PromptDto&gt;" />
      <LineAnalysis line="232" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="233" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            new()" />
      <LineAnalysis line="234" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="235" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Key = &quot;tip-keyboard-shortcuts&quot;," />
      <LineAnalysis line="236" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Title = &quot;Keyboard Shortcuts&quot;," />
      <LineAnalysis line="237" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Message = &quot;Press Ctrl+S to save, Ctrl+N to create a new article. Your work auto-saves as you type!&quot;," />
      <LineAnalysis line="238" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Icon = &quot;âŒ¨ï¸&quot;," />
      <LineAnalysis line="239" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Priority = 100," />
      <LineAnalysis line="240" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Category = PromptCategory.Tip" />
      <LineAnalysis line="241" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            }," />
      <LineAnalysis line="242" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            new()" />
      <LineAnalysis line="243" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="244" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Key = &quot;tip-tree-search&quot;," />
      <LineAnalysis line="245" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Title = &quot;Quick Navigation&quot;," />
      <LineAnalysis line="246" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Message = &quot;Use the search box in the sidebar to quickly filter articles by title.&quot;," />
      <LineAnalysis line="247" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Icon = &quot;ðŸ”&quot;," />
      <LineAnalysis line="248" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Priority = 101," />
      <LineAnalysis line="249" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Category = PromptCategory.Tip" />
      <LineAnalysis line="250" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            }," />
      <LineAnalysis line="251" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            new()" />
      <LineAnalysis line="252" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="253" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Key = &quot;tip-drag-drop&quot;," />
      <LineAnalysis line="254" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Title = &quot;Organize with Drag &amp; Drop&quot;," />
      <LineAnalysis line="255" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Message = &quot;Drag articles in the tree to reorganize your content hierarchy.&quot;," />
      <LineAnalysis line="256" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Icon = &quot;ðŸ“‚&quot;," />
      <LineAnalysis line="257" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Priority = 102," />
      <LineAnalysis line="258" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Category = PromptCategory.Tip" />
      <LineAnalysis line="259" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            }," />
      <LineAnalysis line="260" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            new()" />
      <LineAnalysis line="261" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="262" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Key = &quot;tip-backlinks&quot;," />
      <LineAnalysis line="263" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Title = &quot;Discover Connections&quot;," />
      <LineAnalysis line="264" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Message = &quot;Click the metadata button on any article to see what other articles link to it.&quot;," />
      <LineAnalysis line="265" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Icon = &quot;ðŸ”™&quot;," />
      <LineAnalysis line="266" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Priority = 103," />
      <LineAnalysis line="267" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="                Category = PromptCategory.Tip" />
      <LineAnalysis line="268" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="269" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        };" />
      <LineAnalysis line="270" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="271" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Add a random tip if we need more prompts" />
      <LineAnalysis line="272" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        var random = new Random();" />
      <LineAnalysis line="273" visits="16" coverage="Covered" coveredbranches="" totalbranches="" content="        var shuffledTips = tips.OrderBy(_ =&gt; random.Next()).ToList();" />
      <LineAnalysis line="274" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="275" visits="176" coverage="Covered" coveredbranches="2" totalbranches="2" content="        foreach (var tip in shuffledTips)" />
      <LineAnalysis line="276" visits="64" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="277" visits="64" coverage="Covered" coveredbranches="2" totalbranches="2" content="            if (prompts.Count &lt; MaxPrompts)" />
      <LineAnalysis line="278" visits="34" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="279" visits="34" coverage="Covered" coveredbranches="" totalbranches="" content="                prompts.Add(tip);" />
      <LineAnalysis line="280" visits="34" coverage="Covered" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="281" visits="64" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="282" visits="17" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="283" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="}" />
    </File>
  </Files>
</CoverageReport>