<?xml version="1.0" encoding="utf-8"?>
<CoverageReport scope="Chronicis.Client.Components.World.WorldDocumentUploadDialog">
  <Summary>
    <Class>Chronicis.Client.Components.World.WorldDocumentUploadDialog</Class>
    <Assembly>Chronicis.Client</Assembly>
    <Files>
      <File>Z:\repos\chronicis\src\Chronicis.Client\Components\World\WorldDocumentUploadDialog.razor</File>
    </Files>
    <Coveredlines>24</Coveredlines>
    <Uncoveredlines>0</Uncoveredlines>
    <Coverablelines>24</Coverablelines>
    <Totallines>229</Totallines>
    <Linecoverage>100</Linecoverage>
    <Coveredbranches>4</Coveredbranches>
    <Totalbranches>4</Totalbranches>
    <Branchcoverage>100</Branchcoverage>
    <Coveredmethods>4</Coveredmethods>
    <Fullcoveredmethods>4</Fullcoveredmethods>
    <Totalmethods>4</Totalmethods>
    <Methodcoverage>100</Methodcoverage>
    <Fullmethodcoverage>100</Fullmethodcoverage>
  </Summary>
  <Metrics>
    <Element name="ctor">
      <CrapScore>1</CrapScore>
      <Cyclomaticcomplexity>1</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="cctor">
      <CrapScore>1</CrapScore>
      <Cyclomaticcomplexity>1</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="Cancel">
      <CrapScore>1</CrapScore>
      <Cyclomaticcomplexity>1</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="FormatFileSize">
      <CrapScore>4</CrapScore>
      <Cyclomaticcomplexity>4</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
  </Metrics>
  <Files>
    <File name="Z:\repos\chronicis\src\Chronicis.Client\Components\World\WorldDocumentUploadDialog.razor">
      <LineAnalysis line="1" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="@using Chronicis.Shared.DTOs" />
      <LineAnalysis line="2" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="@using Microsoft.AspNetCore.Components.Forms" />
      <LineAnalysis line="3" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="@inject IWorldApiService WorldApi" />
      <LineAnalysis line="4" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="@inject ISnackbar Snackbar" />
      <LineAnalysis line="5" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="@inject IJSRuntime JSRuntime" />
      <LineAnalysis line="6" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="7" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="&lt;MudDialog&gt;" />
      <LineAnalysis line="8" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    &lt;DialogContent&gt;" />
      <LineAnalysis line="9" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        &lt;MudStack Spacing=&quot;3&quot;&gt;" />
      <LineAnalysis line="10" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            @if (_isUploading)" />
      <LineAnalysis line="11" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="12" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                &lt;MudProgressLinear Color=&quot;Color.Primary&quot; Indeterminate=&quot;true&quot; /&gt;" />
      <LineAnalysis line="13" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                &lt;MudText Typo=&quot;Typo.body2&quot; Align=&quot;Align.Center&quot;&gt;" />
      <LineAnalysis line="14" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                    @_uploadStatus" />
      <LineAnalysis line="15" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                &lt;/MudText&gt;" />
      <LineAnalysis line="16" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="17" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            else" />
      <LineAnalysis line="18" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="19" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                &lt;MudPaper Outlined=&quot;true&quot; Class=&quot;pa-4&quot; Style=&quot;border-style: dashed;&quot;&gt;" />
      <LineAnalysis line="20" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                    &lt;MudStack AlignItems=&quot;AlignItems.Center&quot; Spacing=&quot;2&quot;&gt;" />
      <LineAnalysis line="21" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                        &lt;MudIcon Icon=&quot;@Icons.Material.Filled.CloudUpload&quot; Size=&quot;Size.Large&quot; Color=&quot;Color.Primary&quot; /&gt;" />
      <LineAnalysis line="22" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                        &lt;InputFile id=&quot;fileInput&quot;" />
      <LineAnalysis line="23" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                                   OnChange=&quot;OnFileSelected&quot;" />
      <LineAnalysis line="24" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                                   accept=&quot;.pdf,.docx,.xlsx,.pptx,.txt,.md,.png,.jpg,.jpeg,.gif,.webp&quot;" />
      <LineAnalysis line="25" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                                   style=&quot;display: none;&quot; /&gt;" />
      <LineAnalysis line="26" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                        &lt;label for=&quot;fileInput&quot; style=&quot;cursor: pointer; width: 100%;&quot;&gt;" />
      <LineAnalysis line="27" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                            &lt;MudText Typo=&quot;Typo.h6&quot; Align=&quot;Align.Center&quot;&gt;" />
      <LineAnalysis line="28" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                                @(_selectedFile == null ? &quot;Click to select file&quot; : _selectedFile.Name)" />
      <LineAnalysis line="29" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                            &lt;/MudText&gt;" />
      <LineAnalysis line="30" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                        &lt;/label&gt;" />
      <LineAnalysis line="31" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                        &lt;MudText Typo=&quot;Typo.body2&quot; Color=&quot;Color.Secondary&quot;&gt;" />
      <LineAnalysis line="32" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                            Maximum file size: 200 MB" />
      <LineAnalysis line="33" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                        &lt;/MudText&gt;" />
      <LineAnalysis line="34" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                        &lt;MudText Typo=&quot;Typo.body2&quot; Color=&quot;Color.Secondary&quot;&gt;" />
      <LineAnalysis line="35" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                            Supported: PDF, Word, Excel, PowerPoint, Text, Markdown, Images" />
      <LineAnalysis line="36" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                        &lt;/MudText&gt;" />
      <LineAnalysis line="37" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                    &lt;/MudStack&gt;" />
      <LineAnalysis line="38" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                &lt;/MudPaper&gt;" />
      <LineAnalysis line="39" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="40" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                @if (_selectedFile != null)" />
      <LineAnalysis line="41" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                {" />
      <LineAnalysis line="42" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                    &lt;MudTextField @bind-Value=&quot;_title&quot;" />
      <LineAnalysis line="43" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                                  Label=&quot;Title&quot;" />
      <LineAnalysis line="44" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                                  Variant=&quot;Variant.Outlined&quot;" />
      <LineAnalysis line="45" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                                  HelperText=&quot;Optional: Customize the display name (defaults to filename)&quot; /&gt;" />
      <LineAnalysis line="46" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="47" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                    &lt;MudTextField @bind-Value=&quot;_description&quot;" />
      <LineAnalysis line="48" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                                  Label=&quot;Description&quot;" />
      <LineAnalysis line="49" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                                  Variant=&quot;Variant.Outlined&quot;" />
      <LineAnalysis line="50" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                                  Lines=&quot;3&quot;" />
      <LineAnalysis line="51" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                                  HelperText=&quot;Optional: Add a description for this document&quot; /&gt;" />
      <LineAnalysis line="52" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="53" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                    @if (!string.IsNullOrEmpty(_validationError))" />
      <LineAnalysis line="54" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                    {" />
      <LineAnalysis line="55" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                        &lt;MudAlert Severity=&quot;Severity.Error&quot;&gt;@_validationError&lt;/MudAlert&gt;" />
      <LineAnalysis line="56" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                    }" />
      <LineAnalysis line="57" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                }" />
      <LineAnalysis line="58" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="59" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        &lt;/MudStack&gt;" />
      <LineAnalysis line="60" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    &lt;/DialogContent&gt;" />
      <LineAnalysis line="61" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    &lt;DialogActions&gt;" />
      <LineAnalysis line="62" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        &lt;MudButton OnClick=&quot;Cancel&quot; Disabled=&quot;_isUploading&quot;&gt;Cancel&lt;/MudButton&gt;" />
      <LineAnalysis line="63" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        &lt;MudButton Color=&quot;Color.Primary&quot;" />
      <LineAnalysis line="64" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                   OnClick=&quot;Upload&quot;" />
      <LineAnalysis line="65" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                   Disabled=&quot;_selectedFile == null || _isUploading&quot;&gt;" />
      <LineAnalysis line="66" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            Upload" />
      <LineAnalysis line="67" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        &lt;/MudButton&gt;" />
      <LineAnalysis line="68" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    &lt;/DialogActions&gt;" />
      <LineAnalysis line="69" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="&lt;/MudDialog&gt;" />
      <LineAnalysis line="70" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="71" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="@code {" />
      <LineAnalysis line="72" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    [CascadingParameter] MudDialogInstance MudDialog { get; set; } = null!;" />
      <LineAnalysis line="73" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    [Parameter] public Guid WorldId { get; set; }" />
      <LineAnalysis line="74" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="75" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private IBrowserFile? _selectedFile;" />
      <LineAnalysis line="76" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private byte[]? _fileData;" />
      <LineAnalysis line="77" visits="18" coverage="Covered" coveredbranches="" totalbranches="" content="    private string _title = string.Empty;" />
      <LineAnalysis line="78" visits="18" coverage="Covered" coveredbranches="" totalbranches="" content="    private string _description = string.Empty;" />
      <LineAnalysis line="79" visits="18" coverage="Covered" coveredbranches="" totalbranches="" content="    private string _validationError = string.Empty;" />
      <LineAnalysis line="80" visits="18" coverage="Covered" coveredbranches="" totalbranches="" content="    private bool _isUploading = false;" />
      <LineAnalysis line="81" visits="18" coverage="Covered" coveredbranches="" totalbranches="" content="    private string _uploadStatus = string.Empty;" />
      <LineAnalysis line="82" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="83" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private const long MaxFileSize = 200 * 1024 * 1024; // 200 MB" />
      <LineAnalysis line="84" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="    private static readonly HashSet&lt;string&gt; AllowedExtensions = new()" />
      <LineAnalysis line="85" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="86" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        &quot;.pdf&quot;, &quot;.docx&quot;, &quot;.xlsx&quot;, &quot;.pptx&quot;, &quot;.txt&quot;, &quot;.md&quot;," />
      <LineAnalysis line="87" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        &quot;.png&quot;, &quot;.jpg&quot;, &quot;.jpeg&quot;, &quot;.gif&quot;, &quot;.webp&quot;" />
      <LineAnalysis line="88" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="    };" />
      <LineAnalysis line="89" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="90" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private async Task OnFileSelected(InputFileChangeEventArgs e)" />
      <LineAnalysis line="91" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="92" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        _selectedFile = e.File;" />
      <LineAnalysis line="93" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        _fileData = null;" />
      <LineAnalysis line="94" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        _validationError = string.Empty;" />
      <LineAnalysis line="95" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="96" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        if (_selectedFile != null)" />
      <LineAnalysis line="97" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="98" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            // Default title to filename without extension" />
      <LineAnalysis line="99" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            if (string.IsNullOrWhiteSpace(_title))" />
      <LineAnalysis line="100" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="101" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                _title = Path.GetFileNameWithoutExtension(_selectedFile.Name);" />
      <LineAnalysis line="102" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="103" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="104" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            // Validate file" />
      <LineAnalysis line="105" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            if (_selectedFile.Size &gt; MaxFileSize)" />
      <LineAnalysis line="106" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="107" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                _validationError = $&quot;File size ({FormatFileSize(_selectedFile.Size)}) exceeds maximum of 200 MB&quot;;" />
      <LineAnalysis line="108" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                _selectedFile = null;" />
      <LineAnalysis line="109" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                return;" />
      <LineAnalysis line="110" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="111" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="112" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            var extension = Path.GetExtension(_selectedFile.Name).ToLowerInvariant();" />
      <LineAnalysis line="113" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            if (!AllowedExtensions.Contains(extension))" />
      <LineAnalysis line="114" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="115" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                _validationError = $&quot;File type {extension} is not supported&quot;;" />
      <LineAnalysis line="116" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                _selectedFile = null;" />
      <LineAnalysis line="117" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                return;" />
      <LineAnalysis line="118" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="119" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="120" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            // Read file data immediately to avoid disposal issues" />
      <LineAnalysis line="121" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            try" />
      <LineAnalysis line="122" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="123" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                using var stream = _selectedFile.OpenReadStream(MaxFileSize);" />
      <LineAnalysis line="124" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                using var memoryStream = new MemoryStream();" />
      <LineAnalysis line="125" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                await stream.CopyToAsync(memoryStream);" />
      <LineAnalysis line="126" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                _fileData = memoryStream.ToArray();" />
      <LineAnalysis line="127" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="128" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            catch (Exception ex)" />
      <LineAnalysis line="129" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="130" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                _validationError = $&quot;Failed to read file: {ex.Message}&quot;;" />
      <LineAnalysis line="131" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                _selectedFile = null;" />
      <LineAnalysis line="132" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                _fileData = null;" />
      <LineAnalysis line="133" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="134" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="135" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="136" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        StateHasChanged();" />
      <LineAnalysis line="137" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="138" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="139" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private async Task Upload()" />
      <LineAnalysis line="140" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="141" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        if (_selectedFile == null || _fileData == null) return;" />
      <LineAnalysis line="142" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="143" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        _isUploading = true;" />
      <LineAnalysis line="144" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        _uploadStatus = &quot;Preparing upload...&quot;;" />
      <LineAnalysis line="145" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        StateHasChanged();" />
      <LineAnalysis line="146" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="147" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        try" />
      <LineAnalysis line="148" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="149" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            // Step 1: Request upload (get SAS URL)" />
      <LineAnalysis line="150" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            var request = new WorldDocumentUploadRequestDto" />
      <LineAnalysis line="151" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="152" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                FileName = _selectedFile.Name," />
      <LineAnalysis line="153" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                ContentType = _selectedFile.ContentType," />
      <LineAnalysis line="154" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                FileSizeBytes = _selectedFile.Size," />
      <LineAnalysis line="155" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                Description = _description" />
      <LineAnalysis line="156" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            };" />
      <LineAnalysis line="157" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="158" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            var uploadResponse = await WorldApi.RequestDocumentUploadAsync(WorldId, request);" />
      <LineAnalysis line="159" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="160" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            if (uploadResponse == null)" />
      <LineAnalysis line="161" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="162" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                throw new Exception(&quot;Failed to get upload URL&quot;);" />
      <LineAnalysis line="163" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="164" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="165" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            // Use the server-generated title (may have been renamed for uniqueness)" />
      <LineAnalysis line="166" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            var finalTitle = uploadResponse.Title;" />
      <LineAnalysis line="167" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="168" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            _uploadStatus = &quot;Uploading file...&quot;;" />
      <LineAnalysis line="169" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            StateHasChanged();" />
      <LineAnalysis line="170" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="171" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            // Step 2: Upload file directly to blob storage using SAS URL (from byte array)" />
      <LineAnalysis line="172" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            using var content = new ByteArrayContent(_fileData);" />
      <LineAnalysis line="173" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            content.Headers.ContentType = new System.Net.Http.Headers.MediaTypeHeaderValue(_selectedFile.ContentType);" />
      <LineAnalysis line="174" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="175" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            // Add required blob headers for Azure Storage" />
      <LineAnalysis line="176" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            content.Headers.Add(&quot;x-ms-blob-type&quot;, &quot;BlockBlob&quot;);" />
      <LineAnalysis line="177" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="178" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            using var httpClient = new HttpClient();" />
      <LineAnalysis line="179" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            httpClient.Timeout = TimeSpan.FromMinutes(5); // Allow time for large uploads" />
      <LineAnalysis line="180" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="181" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            var uploadResult = await httpClient.PutAsync(uploadResponse.UploadUrl, content);" />
      <LineAnalysis line="182" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="183" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            if (!uploadResult.IsSuccessStatusCode)" />
      <LineAnalysis line="184" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="185" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                var errorBody = await uploadResult.Content.ReadAsStringAsync();" />
      <LineAnalysis line="186" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                throw new Exception($&quot;Blob upload failed ({uploadResult.StatusCode}): {errorBody}&quot;);" />
      <LineAnalysis line="187" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="188" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="189" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            _uploadStatus = &quot;Finalizing...&quot;;" />
      <LineAnalysis line="190" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            StateHasChanged();" />
      <LineAnalysis line="191" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="192" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            // Step 3: Confirm upload" />
      <LineAnalysis line="193" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            var document = await WorldApi.ConfirmDocumentUploadAsync(WorldId, uploadResponse.DocumentId);" />
      <LineAnalysis line="194" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="195" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            if (document == null)" />
      <LineAnalysis line="196" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="197" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                throw new Exception(&quot;Failed to confirm upload&quot;);" />
      <LineAnalysis line="198" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="199" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="200" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            Snackbar.Add($&quot;Document '{document.Title}' uploaded successfully&quot;, Severity.Success);" />
      <LineAnalysis line="201" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            MudDialog.Close(DialogResult.Ok(document));" />
      <LineAnalysis line="202" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="203" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        catch (Exception ex)" />
      <LineAnalysis line="204" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="205" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            Snackbar.Add($&quot;Upload failed: {ex.Message}&quot;, Severity.Error);" />
      <LineAnalysis line="206" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            _isUploading = false;" />
      <LineAnalysis line="207" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            _uploadStatus = string.Empty;" />
      <LineAnalysis line="208" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            StateHasChanged();" />
      <LineAnalysis line="209" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="210" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="211" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="212" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private void Cancel()" />
      <LineAnalysis line="213" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="214" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        MudDialog.Cancel();" />
      <LineAnalysis line="215" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="216" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="217" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private static string FormatFileSize(long bytes)" />
      <LineAnalysis line="218" visits="5" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="219" visits="5" coverage="Covered" coveredbranches="" totalbranches="" content="        string[] sizes = { &quot;B&quot;, &quot;KB&quot;, &quot;MB&quot;, &quot;GB&quot; };" />
      <LineAnalysis line="220" visits="5" coverage="Covered" coveredbranches="" totalbranches="" content="        double len = bytes;" />
      <LineAnalysis line="221" visits="5" coverage="Covered" coveredbranches="" totalbranches="" content="        int order = 0;" />
      <LineAnalysis line="222" visits="13" coverage="Covered" coveredbranches="4" totalbranches="4" content="        while (len &gt;= 1024 &amp;&amp; order &lt; sizes.Length - 1)" />
      <LineAnalysis line="223" visits="8" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="224" visits="8" coverage="Covered" coveredbranches="" totalbranches="" content="            order++;" />
      <LineAnalysis line="225" visits="8" coverage="Covered" coveredbranches="" totalbranches="" content="            len /= 1024;" />
      <LineAnalysis line="226" visits="8" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="227" visits="5" coverage="Covered" coveredbranches="" totalbranches="" content="        return $&quot;{len:0.##} {sizes[order]}&quot;;" />
      <LineAnalysis line="228" visits="5" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="229" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="}" />
    </File>
  </Files>
</CoverageReport>