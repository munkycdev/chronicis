<?xml version="1.0" encoding="utf-8"?>
<CoverageReport scope="Chronicis.Api.Services.SystemHealthService">
  <Summary>
    <Class>Chronicis.Api.Services.SystemHealthService</Class>
    <Assembly>Chronicis.Api</Assembly>
    <Files>
      <File>Z:\repos\chronicis\src\Chronicis.Api\Services\HealthChecks\SystemHealthService.cs</File>
    </Files>
    <Coveredlines>17</Coveredlines>
    <Uncoveredlines>0</Uncoveredlines>
    <Coverablelines>17</Coverablelines>
    <Totallines>90</Totallines>
    <Linecoverage>100</Linecoverage>
    <Coveredbranches>4</Coveredbranches>
    <Totalbranches>4</Totalbranches>
    <Branchcoverage>100</Branchcoverage>
    <Coveredmethods>2</Coveredmethods>
    <Fullcoveredmethods>2</Fullcoveredmethods>
    <Totalmethods>2</Totalmethods>
    <Methodcoverage>100</Methodcoverage>
    <Fullmethodcoverage>100</Fullmethodcoverage>
  </Summary>
  <Metrics>
    <Element name="ctor">
      <CrapScore>1</CrapScore>
      <Cyclomaticcomplexity>1</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="DetermineOverallStatus">
      <CrapScore>4</CrapScore>
      <Cyclomaticcomplexity>4</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
  </Metrics>
  <Files>
    <File name="Z:\repos\chronicis\src\Chronicis.Api\Services\HealthChecks\SystemHealthService.cs">
      <LineAnalysis line="1" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="using Chronicis.Shared.DTOs;" />
      <LineAnalysis line="2" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="3" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="namespace Chronicis.Api.Services;" />
      <LineAnalysis line="4" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="5" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="public interface ISystemHealthService" />
      <LineAnalysis line="6" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="{" />
      <LineAnalysis line="7" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    Task&lt;SystemHealthStatusDto&gt; GetSystemHealthAsync();" />
      <LineAnalysis line="8" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="}" />
      <LineAnalysis line="9" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="10" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="public class SystemHealthService : ISystemHealthService" />
      <LineAnalysis line="11" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="{" />
      <LineAnalysis line="12" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private readonly DatabaseHealthCheckService _databaseHealth;" />
      <LineAnalysis line="13" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private readonly AzureOpenAIHealthCheckService _azureOpenAIHealth;" />
      <LineAnalysis line="14" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private readonly BlobStorageHealthCheckService _blobStorageHealth;" />
      <LineAnalysis line="15" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private readonly Auth0HealthCheckService _auth0Health;" />
      <LineAnalysis line="16" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private readonly Open5eHealthCheckService _open5eHealth;" />
      <LineAnalysis line="17" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private readonly ILogger&lt;SystemHealthService&gt; _logger;" />
      <LineAnalysis line="18" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="19" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    public SystemHealthService(" />
      <LineAnalysis line="20" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        DatabaseHealthCheckService databaseHealth," />
      <LineAnalysis line="21" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        AzureOpenAIHealthCheckService azureOpenAIHealth," />
      <LineAnalysis line="22" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        BlobStorageHealthCheckService blobStorageHealth," />
      <LineAnalysis line="23" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        Auth0HealthCheckService auth0Health," />
      <LineAnalysis line="24" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        Open5eHealthCheckService open5eHealth," />
      <LineAnalysis line="25" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        ILogger&lt;SystemHealthService&gt; logger)" />
      <LineAnalysis line="26" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="27" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        _databaseHealth = databaseHealth;" />
      <LineAnalysis line="28" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        _azureOpenAIHealth = azureOpenAIHealth;" />
      <LineAnalysis line="29" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        _blobStorageHealth = blobStorageHealth;" />
      <LineAnalysis line="30" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        _auth0Health = auth0Health;" />
      <LineAnalysis line="31" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        _open5eHealth = open5eHealth;" />
      <LineAnalysis line="32" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        _logger = logger;" />
      <LineAnalysis line="33" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="34" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="35" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    public async Task&lt;SystemHealthStatusDto&gt; GetSystemHealthAsync()" />
      <LineAnalysis line="36" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="37" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var timestamp = DateTime.UtcNow;" />
      <LineAnalysis line="38" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        _logger.LogInformation(&quot;Starting system health check&quot;);" />
      <LineAnalysis line="39" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="40" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Run all health checks in parallel" />
      <LineAnalysis line="41" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var healthCheckTasks = new[]" />
      <LineAnalysis line="42" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="43" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            _databaseHealth.CheckHealthAsync(&quot;Database&quot;, ServiceKeys.Database)," />
      <LineAnalysis line="44" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            _azureOpenAIHealth.CheckHealthAsync(&quot;Azure OpenAI&quot;, ServiceKeys.AzureOpenAI)," />
      <LineAnalysis line="45" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            _blobStorageHealth.CheckHealthAsync(&quot;Document Storage&quot;, ServiceKeys.BlobStorage)," />
      <LineAnalysis line="46" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            _auth0Health.CheckHealthAsync(&quot;Auth0&quot;, ServiceKeys.Auth0)," />
      <LineAnalysis line="47" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            _open5eHealth.CheckHealthAsync(&quot;Open5e API&quot;, ServiceKeys.Open5e)" />
      <LineAnalysis line="48" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        };" />
      <LineAnalysis line="49" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="50" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Add API self-check" />
      <LineAnalysis line="51" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var apiHealthTask = Task.FromResult(new ServiceHealthDto" />
      <LineAnalysis line="52" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="53" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            Name = &quot;API&quot;," />
      <LineAnalysis line="54" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            ServiceKey = ServiceKeys.Api," />
      <LineAnalysis line="55" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            Status = HealthStatus.Healthy," />
      <LineAnalysis line="56" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            Message = &quot;API is responding&quot;," />
      <LineAnalysis line="57" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            ResponseTimeMs = 0," />
      <LineAnalysis line="58" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            CheckedAt = timestamp" />
      <LineAnalysis line="59" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        });" />
      <LineAnalysis line="60" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="61" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var allTasks = healthCheckTasks.Concat(new[] { apiHealthTask }).ToArray();" />
      <LineAnalysis line="62" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var results = await Task.WhenAll(allTasks);" />
      <LineAnalysis line="63" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="64" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Determine overall status" />
      <LineAnalysis line="65" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var overallStatus = DetermineOverallStatus(results);" />
      <LineAnalysis line="66" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="67" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        _logger.LogInformation(&quot;System health check completed. Overall status: {Status}&quot;, overallStatus);" />
      <LineAnalysis line="68" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="69" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        return new SystemHealthStatusDto" />
      <LineAnalysis line="70" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="71" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            Timestamp = timestamp," />
      <LineAnalysis line="72" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            OverallStatus = overallStatus," />
      <LineAnalysis line="73" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            Services = results.ToList()" />
      <LineAnalysis line="74" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        };" />
      <LineAnalysis line="75" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="76" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="77" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private static string DetermineOverallStatus(ServiceHealthDto[] services)" />
      <LineAnalysis line="78" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="79" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="        var hasUnhealthy = services.Any(s =&gt; s.Status == HealthStatus.Unhealthy);" />
      <LineAnalysis line="80" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="        var hasDegraded = services.Any(s =&gt; s.Status == HealthStatus.Degraded);" />
      <LineAnalysis line="81" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="82" visits="3" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (hasUnhealthy)" />
      <LineAnalysis line="83" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            return HealthStatus.Unhealthy;" />
      <LineAnalysis line="84" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="85" visits="2" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (hasDegraded)" />
      <LineAnalysis line="86" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            return HealthStatus.Degraded;" />
      <LineAnalysis line="87" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="88" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        return HealthStatus.Healthy;" />
      <LineAnalysis line="89" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="90" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="}" />
    </File>
  </Files>
</CoverageReport>