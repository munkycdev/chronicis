<?xml version="1.0" encoding="utf-8"?>
<CoverageReport scope="Chronicis.Client.Services.Tree.TreeDataBuilder">
  <Summary>
    <Class>Chronicis.Client.Services.Tree.TreeDataBuilder</Class>
    <Assembly>Chronicis.Client</Assembly>
    <Files>
      <File>Z:\repos\chronicis\src\Chronicis.Client\Services\Tree\TreeDataBuilder.cs</File>
    </Files>
    <Coveredlines>251</Coveredlines>
    <Uncoveredlines>0</Uncoveredlines>
    <Coverablelines>251</Coverablelines>
    <Totallines>541</Totallines>
    <Linecoverage>100</Linecoverage>
    <Coveredbranches>48</Coveredbranches>
    <Totalbranches>48</Totalbranches>
    <Branchcoverage>100</Branchcoverage>
    <Coveredmethods>9</Coveredmethods>
    <Fullcoveredmethods>9</Fullcoveredmethods>
    <Totalmethods>9</Totalmethods>
    <Methodcoverage>100</Methodcoverage>
    <Fullmethodcoverage>100</Fullmethodcoverage>
  </Summary>
  <Metrics>
    <Element name="ctor">
      <CrapScore>1</CrapScore>
      <Cyclomaticcomplexity>1</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="BuildWorldNode">
      <CrapScore>18</CrapScore>
      <Cyclomaticcomplexity>18</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="BuildCampaignNode">
      <CrapScore>2</CrapScore>
      <Cyclomaticcomplexity>2</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="BuildArcNode">
      <CrapScore>6</CrapScore>
      <Cyclomaticcomplexity>6</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="BuildSessionNode">
      <CrapScore>4</CrapScore>
      <Cyclomaticcomplexity>4</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="BuildArticleNodeWithChildren">
      <CrapScore>2</CrapScore>
      <Cyclomaticcomplexity>2</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="CreateArticleNode">
      <CrapScore>1</CrapScore>
      <Cyclomaticcomplexity>1</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="CreateVirtualGroupNode">
      <CrapScore>1</CrapScore>
      <Cyclomaticcomplexity>1</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="GetDocumentIcon">
      <CrapScore>16</CrapScore>
      <Cyclomaticcomplexity>16</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
  </Metrics>
  <Files>
    <File name="Z:\repos\chronicis\src\Chronicis.Client\Services\Tree\TreeDataBuilder.cs">
      <LineAnalysis line="1" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="using Chronicis.Client.Models;" />
      <LineAnalysis line="2" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="using Chronicis.Shared.DTOs;" />
      <LineAnalysis line="3" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="using Chronicis.Shared.DTOs.Sessions;" />
      <LineAnalysis line="4" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="using Chronicis.Shared.Enums;" />
      <LineAnalysis line="5" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="6" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="namespace Chronicis.Client.Services.Tree;" />
      <LineAnalysis line="7" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="8" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="/// &lt;summary&gt;" />
      <LineAnalysis line="9" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="/// Responsible for building the navigation tree structure from API data." />
      <LineAnalysis line="10" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="/// Fetches worlds, campaigns, arcs, and articles and constructs the hierarchical tree." />
      <LineAnalysis line="11" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="/// &lt;/summary&gt;" />
      <LineAnalysis line="12" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="internal sealed class TreeDataBuilder" />
      <LineAnalysis line="13" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="{" />
      <LineAnalysis line="14" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private readonly IArticleApiService _articleApi;" />
      <LineAnalysis line="15" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private readonly IWorldApiService _worldApi;" />
      <LineAnalysis line="16" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private readonly ICampaignApiService _campaignApi;" />
      <LineAnalysis line="17" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private readonly IArcApiService _arcApi;" />
      <LineAnalysis line="18" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private readonly ISessionApiService _sessionApi;" />
      <LineAnalysis line="19" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private readonly ILogger _logger;" />
      <LineAnalysis line="20" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="21" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    public TreeDataBuilder(" />
      <LineAnalysis line="22" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        IArticleApiService articleApi," />
      <LineAnalysis line="23" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        IWorldApiService worldApi," />
      <LineAnalysis line="24" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        ICampaignApiService campaignApi," />
      <LineAnalysis line="25" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        IArcApiService arcApi," />
      <LineAnalysis line="26" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        ISessionApiService sessionApi," />
      <LineAnalysis line="27" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        ILogger logger)" />
      <LineAnalysis line="28" visits="21" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="29" visits="21" coverage="Covered" coveredbranches="" totalbranches="" content="        _articleApi = articleApi;" />
      <LineAnalysis line="30" visits="21" coverage="Covered" coveredbranches="" totalbranches="" content="        _worldApi = worldApi;" />
      <LineAnalysis line="31" visits="21" coverage="Covered" coveredbranches="" totalbranches="" content="        _campaignApi = campaignApi;" />
      <LineAnalysis line="32" visits="21" coverage="Covered" coveredbranches="" totalbranches="" content="        _arcApi = arcApi;" />
      <LineAnalysis line="33" visits="21" coverage="Covered" coveredbranches="" totalbranches="" content="        _sessionApi = sessionApi;" />
      <LineAnalysis line="34" visits="21" coverage="Covered" coveredbranches="" totalbranches="" content="        _logger = logger;" />
      <LineAnalysis line="35" visits="21" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="36" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="37" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;summary&gt;" />
      <LineAnalysis line="38" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// Result of building the tree, containing the node index and cached articles." />
      <LineAnalysis line="39" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;/summary&gt;" />
      <LineAnalysis line="40" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    public sealed class BuildResult" />
      <LineAnalysis line="41" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="42" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        public required TreeNodeIndex NodeIndex { get; init; }" />
      <LineAnalysis line="43" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        public required List&lt;ArticleTreeDto&gt; CachedArticles { get; init; }" />
      <LineAnalysis line="44" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="45" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="46" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;summary&gt;" />
      <LineAnalysis line="47" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// Builds the complete tree structure by fetching all data from APIs." />
      <LineAnalysis line="48" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;/summary&gt;" />
      <LineAnalysis line="49" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    public async Task&lt;BuildResult&gt; BuildTreeAsync()" />
      <LineAnalysis line="50" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="51" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var nodeIndex = new TreeNodeIndex();" />
      <LineAnalysis line="52" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var stopwatch = System.Diagnostics.Stopwatch.StartNew();" />
      <LineAnalysis line="53" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="54" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Phase 1: Fetch worlds and articles in parallel" />
      <LineAnalysis line="55" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var worldsTask = _worldApi.GetWorldsAsync();" />
      <LineAnalysis line="56" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var articlesTask = _articleApi.GetAllArticlesAsync();" />
      <LineAnalysis line="57" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="58" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        await Task.WhenAll(worldsTask, articlesTask);" />
      <LineAnalysis line="59" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="60" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var worlds = worldsTask.Result;" />
      <LineAnalysis line="61" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var allArticles = articlesTask.Result;" />
      <LineAnalysis line="62" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="63" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        if (!worlds.Any())" />
      <LineAnalysis line="64" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="65" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            return new BuildResult" />
      <LineAnalysis line="66" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="67" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                NodeIndex = nodeIndex," />
      <LineAnalysis line="68" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                CachedArticles = allArticles" />
      <LineAnalysis line="69" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            };" />
      <LineAnalysis line="70" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="71" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="72" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Phase 2: Fetch all world details in parallel" />
      <LineAnalysis line="73" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        _logger.LogDebug(&quot;Phase 2: Fetching world details in parallel...&quot;);" />
      <LineAnalysis line="74" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var worldDetailTasks = worlds.Select(w =&gt; _worldApi.GetWorldAsync(w.Id)).ToList();" />
      <LineAnalysis line="75" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var worldDetails = await Task.WhenAll(worldDetailTasks);" />
      <LineAnalysis line="76" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="77" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var worldDetailLookup = worldDetails" />
      <LineAnalysis line="78" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            .Where(wd =&gt; wd != null)" />
      <LineAnalysis line="79" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            .ToDictionary(wd =&gt; wd!.Id, wd =&gt; wd!);" />
      <LineAnalysis line="80" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="81" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        _logger.LogDebug(&quot;Phase 2 complete: {Count} world details in {Ms}ms&quot;," />
      <LineAnalysis line="82" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            worldDetailLookup.Count, stopwatch.ElapsedMilliseconds);" />
      <LineAnalysis line="83" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="84" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Phase 3: Collect all campaigns and fetch arcs, links, documents in parallel" />
      <LineAnalysis line="85" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var allCampaigns = worldDetails" />
      <LineAnalysis line="86" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            .Where(wd =&gt; wd != null)" />
      <LineAnalysis line="87" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            .SelectMany(wd =&gt; wd!.Campaigns ?? new List&lt;CampaignDto&gt;())" />
      <LineAnalysis line="88" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            .ToList();" />
      <LineAnalysis line="89" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="90" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        _logger.LogDebug(&quot;Phase 3: Fetching arcs for {Count} campaigns, world links, and documents in parallel...&quot;, allCampaigns.Count);" />
      <LineAnalysis line="91" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="92" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var arcTasks = allCampaigns.Select(c =&gt; _arcApi.GetArcsByCampaignAsync(c.Id)).ToList();" />
      <LineAnalysis line="93" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var linkTasks = worlds.Select(w =&gt; _worldApi.GetWorldLinksAsync(w.Id)).ToList();" />
      <LineAnalysis line="94" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var documentTasks = worlds.Select(w =&gt; _worldApi.GetWorldDocumentsAsync(w.Id)).ToList();" />
      <LineAnalysis line="95" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="96" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        await Task.WhenAll(" />
      <LineAnalysis line="97" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            Task.WhenAll(arcTasks)," />
      <LineAnalysis line="98" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            Task.WhenAll(linkTasks)," />
      <LineAnalysis line="99" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            Task.WhenAll(documentTasks)" />
      <LineAnalysis line="100" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        );" />
      <LineAnalysis line="101" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="102" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var arcResults = arcTasks.Select(t =&gt; t.Result).ToArray();" />
      <LineAnalysis line="103" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="104" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var linksByWorld = new Dictionary&lt;Guid, List&lt;WorldLinkDto&gt;&gt;();" />
      <LineAnalysis line="105" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        for (int i = 0; i &lt; worlds.Count; i++)" />
      <LineAnalysis line="106" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="107" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            linksByWorld[worlds[i].Id] = linkTasks[i].Result;" />
      <LineAnalysis line="108" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="109" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="110" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var documentsByWorld = new Dictionary&lt;Guid, List&lt;WorldDocumentDto&gt;&gt;();" />
      <LineAnalysis line="111" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        for (int i = 0; i &lt; worlds.Count; i++)" />
      <LineAnalysis line="112" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="113" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            documentsByWorld[worlds[i].Id] = documentTasks[i].Result;" />
      <LineAnalysis line="114" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="115" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="116" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var arcsByCampaign = new Dictionary&lt;Guid, List&lt;ArcDto&gt;&gt;();" />
      <LineAnalysis line="117" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        for (int i = 0; i &lt; allCampaigns.Count; i++)" />
      <LineAnalysis line="118" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="119" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            arcsByCampaign[allCampaigns[i].Id] = arcResults[i];" />
      <LineAnalysis line="120" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="121" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="122" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Phase 3b: Fetch sessions for all arcs in parallel" />
      <LineAnalysis line="123" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var allArcs = arcResults.SelectMany(r =&gt; r).ToList();" />
      <LineAnalysis line="124" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var sessionTasks = allArcs.Select(a =&gt; _sessionApi.GetSessionsByArcAsync(a.Id)).ToList();" />
      <LineAnalysis line="125" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        await Task.WhenAll(sessionTasks);" />
      <LineAnalysis line="126" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="127" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var sessionsByArc = new Dictionary&lt;Guid, List&lt;SessionTreeDto&gt;&gt;();" />
      <LineAnalysis line="128" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        for (int i = 0; i &lt; allArcs.Count; i++)" />
      <LineAnalysis line="129" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="130" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            sessionsByArc[allArcs[i].Id] = sessionTasks[i].Result;" />
      <LineAnalysis line="131" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="132" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="133" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        _logger.LogDebug(&quot;Phase 3 complete: {Count} total arcs in {Ms}ms&quot;," />
      <LineAnalysis line="134" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            arcResults.Sum(r =&gt; r.Count), stopwatch.ElapsedMilliseconds);" />
      <LineAnalysis line="135" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="136" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Phase 4: Build the tree structure" />
      <LineAnalysis line="137" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        _logger.LogDebug(&quot;Phase 4: Building tree structure...&quot;);" />
      <LineAnalysis line="138" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="139" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var articleIndex = allArticles.ToDictionary(a =&gt; a.Id);" />
      <LineAnalysis line="140" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="141" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        foreach (var world in worlds.OrderBy(w =&gt; w.Name))" />
      <LineAnalysis line="142" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="143" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            if (!worldDetailLookup.TryGetValue(world.Id, out var worldDetail))" />
      <LineAnalysis line="144" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="145" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                _logger.LogWarning(&quot;World detail not found for {WorldId}&quot;, world.Id);" />
      <LineAnalysis line="146" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                continue;" />
      <LineAnalysis line="147" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="148" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="149" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            var worldLinks = linksByWorld[world.Id];" />
      <LineAnalysis line="150" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            var worldDocuments = documentsByWorld[world.Id];" />
      <LineAnalysis line="151" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="152" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            var worldNode = BuildWorldNode(" />
      <LineAnalysis line="153" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                world," />
      <LineAnalysis line="154" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                worldDetail," />
      <LineAnalysis line="155" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                allArticles," />
      <LineAnalysis line="156" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                articleIndex," />
      <LineAnalysis line="157" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                arcsByCampaign," />
      <LineAnalysis line="158" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                sessionsByArc," />
      <LineAnalysis line="159" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                worldLinks," />
      <LineAnalysis line="160" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                worldDocuments," />
      <LineAnalysis line="161" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                nodeIndex);" />
      <LineAnalysis line="162" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="163" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            nodeIndex.AddRootNode(worldNode);" />
      <LineAnalysis line="164" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="165" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="166" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Handle orphan articles (no world assigned)" />
      <LineAnalysis line="167" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        var orphanArticles = allArticles.Where(a =&gt; !a.WorldId.HasValue &amp;&amp; a.ParentId == null).ToList();" />
      <LineAnalysis line="168" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        if (orphanArticles.Any())" />
      <LineAnalysis line="169" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="170" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            _logger.LogWarning(&quot;{Count} articles have no world assigned&quot;, orphanArticles.Count);" />
      <LineAnalysis line="171" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="172" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            var orphanNode = CreateVirtualGroupNode(" />
      <LineAnalysis line="173" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                VirtualGroupType.Uncategorized," />
      <LineAnalysis line="174" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                &quot;Unassigned Articles&quot;," />
      <LineAnalysis line="175" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                null);" />
      <LineAnalysis line="176" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="177" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            foreach (var article in orphanArticles)" />
      <LineAnalysis line="178" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="179" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                var articleNode = CreateArticleNode(article);" />
      <LineAnalysis line="180" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                orphanNode.Children.Add(articleNode);" />
      <LineAnalysis line="181" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                nodeIndex.AddNode(articleNode);" />
      <LineAnalysis line="182" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="183" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="184" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            if (orphanNode.Children.Any())" />
      <LineAnalysis line="185" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="186" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                orphanNode.ChildCount = orphanNode.Children.Count;" />
      <LineAnalysis line="187" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="                nodeIndex.AddRootNode(orphanNode);" />
      <LineAnalysis line="188" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="189" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="190" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="191" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        stopwatch.Stop();" />
      <LineAnalysis line="192" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        _logger.LogDebug(&quot;Tree build complete in {Ms}ms total&quot;, stopwatch.ElapsedMilliseconds);" />
      <LineAnalysis line="193" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="194" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        return new BuildResult" />
      <LineAnalysis line="195" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="196" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            NodeIndex = nodeIndex," />
      <LineAnalysis line="197" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            CachedArticles = allArticles" />
      <LineAnalysis line="198" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        };" />
      <LineAnalysis line="199" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="200" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="201" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private TreeNode BuildWorldNode(" />
      <LineAnalysis line="202" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        WorldDto world," />
      <LineAnalysis line="203" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        WorldDetailDto worldDetail," />
      <LineAnalysis line="204" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        List&lt;ArticleTreeDto&gt; allArticles," />
      <LineAnalysis line="205" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        Dictionary&lt;Guid, ArticleTreeDto&gt; articleIndex," />
      <LineAnalysis line="206" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        Dictionary&lt;Guid, List&lt;ArcDto&gt;&gt; arcsByCampaign," />
      <LineAnalysis line="207" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        Dictionary&lt;Guid, List&lt;SessionTreeDto&gt;&gt; sessionsByArc," />
      <LineAnalysis line="208" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        List&lt;WorldLinkDto&gt; worldLinks," />
      <LineAnalysis line="209" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        List&lt;WorldDocumentDto&gt; worldDocuments," />
      <LineAnalysis line="210" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        TreeNodeIndex nodeIndex)" />
      <LineAnalysis line="211" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="212" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        var worldNode = new TreeNode" />
      <LineAnalysis line="213" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="214" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            Id = world.Id," />
      <LineAnalysis line="215" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            NodeType = TreeNodeType.World," />
      <LineAnalysis line="216" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            Title = world.Name," />
      <LineAnalysis line="217" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            WorldId = world.Id," />
      <LineAnalysis line="218" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            IconEmoji = &quot;fa-solid fa-globe&quot;" />
      <LineAnalysis line="219" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        };" />
      <LineAnalysis line="220" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="221" visits="23" coverage="Covered" coveredbranches="2" totalbranches="2" content="        var campaigns = worldDetail.Campaigns ?? new List&lt;CampaignDto&gt;();" />
      <LineAnalysis line="222" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        var worldArticles = allArticles.Where(a =&gt; a.WorldId == world.Id).ToList();" />
      <LineAnalysis line="223" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="224" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Create virtual groups" />
      <LineAnalysis line="225" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        var campaignsGroup = CreateVirtualGroupNode(VirtualGroupType.Campaigns, &quot;Campaigns&quot;, world.Id);" />
      <LineAnalysis line="226" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        var charactersGroup = CreateVirtualGroupNode(VirtualGroupType.PlayerCharacters, &quot;Player Characters&quot;, world.Id);" />
      <LineAnalysis line="227" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        var wikiGroup = CreateVirtualGroupNode(VirtualGroupType.Wiki, &quot;Wiki&quot;, world.Id);" />
      <LineAnalysis line="228" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        var uncategorizedGroup = CreateVirtualGroupNode(VirtualGroupType.Uncategorized, &quot;Uncategorized&quot;, world.Id);" />
      <LineAnalysis line="229" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="230" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Build Campaigns group" />
      <LineAnalysis line="231" visits="113" coverage="Covered" coveredbranches="2" totalbranches="2" content="        foreach (var campaign in campaigns.OrderBy(c =&gt; c.Name))" />
      <LineAnalysis line="232" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="233" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            var arcs = arcsByCampaign[campaign.Id];" />
      <LineAnalysis line="234" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="235" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            var campaignNode = BuildCampaignNode(campaign, arcs, worldArticles, articleIndex, sessionsByArc, nodeIndex);" />
      <LineAnalysis line="236" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            campaignsGroup.Children.Add(campaignNode);" />
      <LineAnalysis line="237" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            nodeIndex.AddNode(campaignNode);" />
      <LineAnalysis line="238" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="239" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        campaignsGroup.ChildCount = campaignsGroup.Children.Count;" />
      <LineAnalysis line="240" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="241" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Build Characters group" />
      <LineAnalysis line="242" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        var characterArticles = worldArticles" />
      <LineAnalysis line="243" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            .Where(a =&gt; a.Type == ArticleType.Character &amp;&amp; a.ParentId == null).OrderBy(a =&gt; a.Title).ToList();" />
      <LineAnalysis line="244" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="245" visits="73" coverage="Covered" coveredbranches="2" totalbranches="2" content="        foreach (var article in characterArticles)" />
      <LineAnalysis line="246" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="247" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            var articleNode = BuildArticleNodeWithChildren(article, worldArticles, articleIndex, nodeIndex);" />
      <LineAnalysis line="248" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            charactersGroup.Children.Add(articleNode);" />
      <LineAnalysis line="249" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="250" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        charactersGroup.ChildCount = charactersGroup.Children.Count;" />
      <LineAnalysis line="251" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="252" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Build Wiki group" />
      <LineAnalysis line="253" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        var wikiArticles = worldArticles" />
      <LineAnalysis line="254" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            .Where(a =&gt; a.Type == ArticleType.WikiArticle &amp;&amp; a.ParentId == null)" />
      <LineAnalysis line="255" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            .OrderBy(a =&gt; a.Title)" />
      <LineAnalysis line="256" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            .ToList();" />
      <LineAnalysis line="257" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="258" visits="113" coverage="Covered" coveredbranches="2" totalbranches="2" content="        foreach (var article in wikiArticles)" />
      <LineAnalysis line="259" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="260" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            var articleNode = BuildArticleNodeWithChildren(article, worldArticles, articleIndex, nodeIndex);" />
      <LineAnalysis line="261" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            wikiGroup.Children.Add(articleNode);" />
      <LineAnalysis line="262" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="263" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        wikiGroup.ChildCount = wikiGroup.Children.Count;" />
      <LineAnalysis line="264" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="265" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Build Links group" />
      <LineAnalysis line="266" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        var linksGroup = CreateVirtualGroupNode(VirtualGroupType.Links, &quot;External Resources&quot;, world.Id);" />
      <LineAnalysis line="267" visits="71" coverage="Covered" coveredbranches="2" totalbranches="2" content="        foreach (var link in worldLinks.OrderBy(l =&gt; l.Title))" />
      <LineAnalysis line="268" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="269" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            var linkNode = new TreeNode" />
      <LineAnalysis line="270" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="271" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Id = link.Id," />
      <LineAnalysis line="272" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                NodeType = TreeNodeType.ExternalLink," />
      <LineAnalysis line="273" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Title = link.Title," />
      <LineAnalysis line="274" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Url = link.Url," />
      <LineAnalysis line="275" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                WorldId = world.Id," />
      <LineAnalysis line="276" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                IconEmoji = &quot;fa-solid fa-external-link-alt&quot;" />
      <LineAnalysis line="277" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            };" />
      <LineAnalysis line="278" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            linksGroup.Children.Add(linkNode);" />
      <LineAnalysis line="279" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            nodeIndex.AddNode(linkNode);" />
      <LineAnalysis line="280" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="281" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="282" visits="71" coverage="Covered" coveredbranches="2" totalbranches="2" content="        foreach (var document in worldDocuments.Where(d =&gt; d.ArticleId == null).OrderBy(d =&gt; d.Title))" />
      <LineAnalysis line="283" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="284" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            var documentNode = new TreeNode" />
      <LineAnalysis line="285" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="286" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Id = document.Id," />
      <LineAnalysis line="287" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                NodeType = TreeNodeType.ExternalLink," />
      <LineAnalysis line="288" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Title = document.Title," />
      <LineAnalysis line="289" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                Url = null," />
      <LineAnalysis line="290" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                WorldId = world.Id," />
      <LineAnalysis line="291" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                IconEmoji = GetDocumentIcon(document.ContentType)," />
      <LineAnalysis line="292" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                AdditionalData = new Dictionary&lt;string, object&gt;" />
      <LineAnalysis line="293" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                {" />
      <LineAnalysis line="294" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                    { &quot;IsDocument&quot;, true }," />
      <LineAnalysis line="295" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                    { &quot;ContentType&quot;, document.ContentType }," />
      <LineAnalysis line="296" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                    { &quot;FileSizeBytes&quot;, document.FileSizeBytes }," />
      <LineAnalysis line="297" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                    { &quot;FileName&quot;, document.FileName }" />
      <LineAnalysis line="298" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="                }" />
      <LineAnalysis line="299" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            };" />
      <LineAnalysis line="300" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            linksGroup.Children.Add(documentNode);" />
      <LineAnalysis line="301" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            nodeIndex.AddNode(documentNode);" />
      <LineAnalysis line="302" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="303" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        linksGroup.ChildCount = linksGroup.Children.Count;" />
      <LineAnalysis line="304" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="305" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Build Uncategorized group" />
      <LineAnalysis line="306" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        var uncategorizedArticles = worldArticles" />
      <LineAnalysis line="307" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            .Where(a =&gt; a.ParentId == null &amp;&amp;" />
      <LineAnalysis line="308" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="                       a.Type != ArticleType.WikiArticle &amp;&amp;" />
      <LineAnalysis line="309" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="                       a.Type != ArticleType.Character &amp;&amp;" />
      <LineAnalysis line="310" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="                       a.Type != ArticleType.Session &amp;&amp;" />
      <LineAnalysis line="311" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="                       a.Type != ArticleType.SessionNote &amp;&amp;" />
      <LineAnalysis line="312" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="                       a.Type != ArticleType.CharacterNote).OrderBy(a =&gt; a.Title).ToList();" />
      <LineAnalysis line="313" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="314" visits="73" coverage="Covered" coveredbranches="2" totalbranches="2" content="        foreach (var article in uncategorizedArticles)" />
      <LineAnalysis line="315" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="316" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            var articleNode = BuildArticleNodeWithChildren(article, worldArticles, articleIndex, nodeIndex);" />
      <LineAnalysis line="317" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            uncategorizedGroup.Children.Add(articleNode);" />
      <LineAnalysis line="318" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="319" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        uncategorizedGroup.ChildCount = uncategorizedGroup.Children.Count;" />
      <LineAnalysis line="320" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="321" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Add groups to world node" />
      <LineAnalysis line="322" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        worldNode.Children.Add(campaignsGroup);" />
      <LineAnalysis line="323" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        nodeIndex.AddNode(campaignsGroup);" />
      <LineAnalysis line="324" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="325" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        worldNode.Children.Add(charactersGroup);" />
      <LineAnalysis line="326" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        nodeIndex.AddNode(charactersGroup);" />
      <LineAnalysis line="327" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="328" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        worldNode.Children.Add(wikiGroup);" />
      <LineAnalysis line="329" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        nodeIndex.AddNode(wikiGroup);" />
      <LineAnalysis line="330" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="331" visits="23" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (linksGroup.Children.Any())" />
      <LineAnalysis line="332" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="333" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            worldNode.Children.Add(linksGroup);" />
      <LineAnalysis line="334" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            nodeIndex.AddNode(linksGroup);" />
      <LineAnalysis line="335" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="336" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="337" visits="23" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (uncategorizedGroup.Children.Any())" />
      <LineAnalysis line="338" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="339" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            worldNode.Children.Add(uncategorizedGroup);" />
      <LineAnalysis line="340" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            nodeIndex.AddNode(uncategorizedGroup);" />
      <LineAnalysis line="341" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="342" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="343" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        worldNode.ChildCount = worldNode.Children.Count;" />
      <LineAnalysis line="344" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="345" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        return worldNode;" />
      <LineAnalysis line="346" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="347" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="348" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private TreeNode BuildCampaignNode(" />
      <LineAnalysis line="349" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        CampaignDto campaign," />
      <LineAnalysis line="350" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        List&lt;ArcDto&gt; arcs," />
      <LineAnalysis line="351" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        List&lt;ArticleTreeDto&gt; worldArticles," />
      <LineAnalysis line="352" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        Dictionary&lt;Guid, ArticleTreeDto&gt; articleIndex," />
      <LineAnalysis line="353" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        Dictionary&lt;Guid, List&lt;SessionTreeDto&gt;&gt; sessionsByArc," />
      <LineAnalysis line="354" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        TreeNodeIndex nodeIndex)" />
      <LineAnalysis line="355" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="356" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="        var campaignNode = new TreeNode" />
      <LineAnalysis line="357" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="358" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            Id = campaign.Id," />
      <LineAnalysis line="359" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            NodeType = TreeNodeType.Campaign," />
      <LineAnalysis line="360" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            Title = campaign.Name," />
      <LineAnalysis line="361" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            WorldId = campaign.WorldId," />
      <LineAnalysis line="362" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            CampaignId = campaign.Id," />
      <LineAnalysis line="363" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            IconEmoji = &quot;fa-solid fa-dungeon&quot;" />
      <LineAnalysis line="364" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="        };" />
      <LineAnalysis line="365" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="366" visits="110" coverage="Covered" coveredbranches="2" totalbranches="2" content="        foreach (var arc in arcs.OrderBy(a =&gt; a.SortOrder).ThenBy(a =&gt; a.Name))" />
      <LineAnalysis line="367" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="368" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            var arcNode = BuildArcNode(arc, worldArticles, articleIndex, sessionsByArc, nodeIndex);" />
      <LineAnalysis line="369" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            campaignNode.Children.Add(arcNode);" />
      <LineAnalysis line="370" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="            nodeIndex.AddNode(arcNode);" />
      <LineAnalysis line="371" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="372" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="373" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="        campaignNode.ChildCount = campaignNode.Children.Count;" />
      <LineAnalysis line="374" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="375" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="        return campaignNode;" />
      <LineAnalysis line="376" visits="22" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="377" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="378" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private TreeNode BuildArcNode(" />
      <LineAnalysis line="379" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        ArcDto arc," />
      <LineAnalysis line="380" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        List&lt;ArticleTreeDto&gt; worldArticles," />
      <LineAnalysis line="381" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        Dictionary&lt;Guid, ArticleTreeDto&gt; articleIndex," />
      <LineAnalysis line="382" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        Dictionary&lt;Guid, List&lt;SessionTreeDto&gt;&gt; sessionsByArc," />
      <LineAnalysis line="383" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        TreeNodeIndex nodeIndex)" />
      <LineAnalysis line="384" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="385" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        var arcNode = new TreeNode" />
      <LineAnalysis line="386" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="387" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            Id = arc.Id," />
      <LineAnalysis line="388" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            NodeType = TreeNodeType.Arc," />
      <LineAnalysis line="389" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            Title = arc.Name," />
      <LineAnalysis line="390" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            CampaignId = arc.CampaignId," />
      <LineAnalysis line="391" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            ArcId = arc.Id," />
      <LineAnalysis line="392" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            IconEmoji = &quot;fa-solid fa-book-open&quot;" />
      <LineAnalysis line="393" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        };" />
      <LineAnalysis line="394" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="395" visits="23" coverage="Covered" coveredbranches="2" totalbranches="2" content="        var sessions = sessionsByArc.TryGetValue(arc.Id, out var sessionList)" />
      <LineAnalysis line="396" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            ? sessionList" />
      <LineAnalysis line="397" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="            : new List&lt;SessionTreeDto&gt;();" />
      <LineAnalysis line="398" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="399" visits="23" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (sessions.Count &gt; 0)" />
      <LineAnalysis line="400" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="401" visits="15" coverage="Covered" coveredbranches="2" totalbranches="2" content="            foreach (var session in sessions)" />
      <LineAnalysis line="402" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            {" />
      <LineAnalysis line="403" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="                var sessionNode = BuildSessionNode(session, arc, worldArticles, articleIndex, nodeIndex);" />
      <LineAnalysis line="404" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="                arcNode.Children.Add(sessionNode);" />
      <LineAnalysis line="405" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            }" />
      <LineAnalysis line="406" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="407" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="408" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        arcNode.ChildCount = arcNode.Children.Count;" />
      <LineAnalysis line="409" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="410" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="        return arcNode;" />
      <LineAnalysis line="411" visits="23" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="412" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="413" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private TreeNode BuildSessionNode(" />
      <LineAnalysis line="414" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        SessionTreeDto session," />
      <LineAnalysis line="415" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        ArcDto arc," />
      <LineAnalysis line="416" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        List&lt;ArticleTreeDto&gt; worldArticles," />
      <LineAnalysis line="417" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        Dictionary&lt;Guid, ArticleTreeDto&gt; articleIndex," />
      <LineAnalysis line="418" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        TreeNodeIndex nodeIndex)" />
      <LineAnalysis line="419" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="420" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="        var sessionNode = new TreeNode" />
      <LineAnalysis line="421" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="422" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            Id = session.Id," />
      <LineAnalysis line="423" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            NodeType = TreeNodeType.Session," />
      <LineAnalysis line="424" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            Title = session.Name," />
      <LineAnalysis line="425" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            CampaignId = arc.CampaignId," />
      <LineAnalysis line="426" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            ArcId = arc.Id," />
      <LineAnalysis line="427" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            IconEmoji = &quot;fa-solid fa-calendar-day&quot;," />
      <LineAnalysis line="428" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            HasAISummary = session.HasAiSummary" />
      <LineAnalysis line="429" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="        };" />
      <LineAnalysis line="430" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="431" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="        nodeIndex.AddNode(sessionNode);" />
      <LineAnalysis line="432" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="433" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="        var sessionNotes = worldArticles" />
      <LineAnalysis line="434" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            .Where(a =&gt; a.Type == ArticleType.SessionNote &amp;&amp; a.SessionId == session.Id)" />
      <LineAnalysis line="435" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            .OrderBy(a =&gt; a.Title)" />
      <LineAnalysis line="436" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            .ToList();" />
      <LineAnalysis line="437" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="438" visits="3" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (sessionNotes.Count == 0)" />
      <LineAnalysis line="439" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="440" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            sessionNode.ChildCount = 0;" />
      <LineAnalysis line="441" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            return sessionNode;" />
      <LineAnalysis line="442" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="443" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="444" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        var sessionNoteIds = sessionNotes.Select(n =&gt; n.Id).ToHashSet();" />
      <LineAnalysis line="445" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        var rootSessionNotes = sessionNotes" />
      <LineAnalysis line="446" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            .Where(n =&gt; !n.ParentId.HasValue || !sessionNoteIds.Contains(n.ParentId.Value))" />
      <LineAnalysis line="447" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            .ToList();" />
      <LineAnalysis line="448" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="449" visits="10" coverage="Covered" coveredbranches="2" totalbranches="2" content="        foreach (var note in rootSessionNotes)" />
      <LineAnalysis line="450" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="451" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            var noteNode = BuildArticleNodeWithChildren(note, sessionNotes, articleIndex, nodeIndex);" />
      <LineAnalysis line="452" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            noteNode.ParentId = sessionNode.Id;" />
      <LineAnalysis line="453" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            sessionNode.Children.Add(noteNode);" />
      <LineAnalysis line="454" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="455" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="456" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        sessionNode.ChildCount = sessionNode.Children.Count;" />
      <LineAnalysis line="457" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        return sessionNode;" />
      <LineAnalysis line="458" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="459" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="460" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private TreeNode BuildArticleNodeWithChildren(" />
      <LineAnalysis line="461" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        ArticleTreeDto article," />
      <LineAnalysis line="462" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        List&lt;ArticleTreeDto&gt; allArticles," />
      <LineAnalysis line="463" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        Dictionary&lt;Guid, ArticleTreeDto&gt; articleIndex," />
      <LineAnalysis line="464" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        TreeNodeIndex nodeIndex)" />
      <LineAnalysis line="465" visits="30" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="466" visits="30" coverage="Covered" coveredbranches="" totalbranches="" content="        var node = CreateArticleNode(article);" />
      <LineAnalysis line="467" visits="30" coverage="Covered" coveredbranches="" totalbranches="" content="        nodeIndex.AddNode(node);" />
      <LineAnalysis line="468" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="469" visits="30" coverage="Covered" coveredbranches="" totalbranches="" content="        var children = allArticles" />
      <LineAnalysis line="470" visits="30" coverage="Covered" coveredbranches="" totalbranches="" content="            .Where(a =&gt; a.ParentId == article.Id)" />
      <LineAnalysis line="471" visits="30" coverage="Covered" coveredbranches="" totalbranches="" content="            .OrderBy(a =&gt; a.Title)" />
      <LineAnalysis line="472" visits="30" coverage="Covered" coveredbranches="" totalbranches="" content="            .ToList();" />
      <LineAnalysis line="473" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="474" visits="94" coverage="Covered" coveredbranches="2" totalbranches="2" content="        foreach (var child in children)" />
      <LineAnalysis line="475" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="476" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            var childNode = BuildArticleNodeWithChildren(child, allArticles, articleIndex, nodeIndex);" />
      <LineAnalysis line="477" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            childNode.ParentId = node.Id;" />
      <LineAnalysis line="478" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            node.Children.Add(childNode);" />
      <LineAnalysis line="479" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="480" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="481" visits="30" coverage="Covered" coveredbranches="" totalbranches="" content="        node.ChildCount = node.Children.Count;" />
      <LineAnalysis line="482" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="483" visits="30" coverage="Covered" coveredbranches="" totalbranches="" content="        return node;" />
      <LineAnalysis line="484" visits="30" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="485" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="486" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;summary&gt;" />
      <LineAnalysis line="487" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// Creates a TreeNode from an ArticleTreeDto." />
      <LineAnalysis line="488" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;/summary&gt;" />
      <LineAnalysis line="489" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    public static TreeNode CreateArticleNode(ArticleTreeDto article)" />
      <LineAnalysis line="490" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="491" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="        return new TreeNode" />
      <LineAnalysis line="492" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="493" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="            Id = article.Id," />
      <LineAnalysis line="494" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="            NodeType = TreeNodeType.Article," />
      <LineAnalysis line="495" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="            ArticleType = article.Type," />
      <LineAnalysis line="496" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="            Title = article.Title," />
      <LineAnalysis line="497" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="            Slug = article.Slug," />
      <LineAnalysis line="498" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="            IconEmoji = article.IconEmoji," />
      <LineAnalysis line="499" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="            ParentId = article.ParentId," />
      <LineAnalysis line="500" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="            WorldId = article.WorldId," />
      <LineAnalysis line="501" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="            CampaignId = article.CampaignId," />
      <LineAnalysis line="502" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="            ArcId = article.ArcId," />
      <LineAnalysis line="503" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="            ChildCount = article.ChildCount," />
      <LineAnalysis line="504" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="            Visibility = article.Visibility," />
      <LineAnalysis line="505" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="            HasAISummary = article.HasAISummary" />
      <LineAnalysis line="506" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="        };" />
      <LineAnalysis line="507" visits="32" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="508" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="509" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;summary&gt;" />
      <LineAnalysis line="510" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// Creates a virtual group node." />
      <LineAnalysis line="511" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;/summary&gt;" />
      <LineAnalysis line="512" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    public static TreeNode CreateVirtualGroupNode(VirtualGroupType groupType, string title, Guid? worldId)" />
      <LineAnalysis line="513" visits="117" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="514" visits="117" coverage="Covered" coveredbranches="" totalbranches="" content="        return new TreeNode" />
      <LineAnalysis line="515" visits="117" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="516" visits="117" coverage="Covered" coveredbranches="" totalbranches="" content="            Id = Guid.NewGuid()," />
      <LineAnalysis line="517" visits="117" coverage="Covered" coveredbranches="" totalbranches="" content="            NodeType = TreeNodeType.VirtualGroup," />
      <LineAnalysis line="518" visits="117" coverage="Covered" coveredbranches="" totalbranches="" content="            VirtualGroupType = groupType," />
      <LineAnalysis line="519" visits="117" coverage="Covered" coveredbranches="" totalbranches="" content="            Title = title," />
      <LineAnalysis line="520" visits="117" coverage="Covered" coveredbranches="" totalbranches="" content="            WorldId = worldId" />
      <LineAnalysis line="521" visits="117" coverage="Covered" coveredbranches="" totalbranches="" content="        };" />
      <LineAnalysis line="522" visits="117" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="523" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="524" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;summary&gt;" />
      <LineAnalysis line="525" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// Gets the appropriate icon for a document based on its content type." />
      <LineAnalysis line="526" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;/summary&gt;" />
      <LineAnalysis line="527" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    public static string GetDocumentIcon(string contentType)" />
      <LineAnalysis line="528" visits="9" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="529" visits="9" coverage="Covered" coveredbranches="14" totalbranches="14" content="        return contentType.ToLowerInvariant() switch" />
      <LineAnalysis line="530" visits="9" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="531" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            &quot;application/pdf&quot; =&gt; &quot;fa-solid fa-file-pdf&quot;," />
      <LineAnalysis line="532" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            &quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot; =&gt; &quot;fa-solid fa-file-word&quot;," />
      <LineAnalysis line="533" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            &quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot; =&gt; &quot;fa-solid fa-file-excel&quot;," />
      <LineAnalysis line="534" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            &quot;application/vnd.openxmlformats-officedocument.presentationml.presentation&quot; =&gt; &quot;fa-solid fa-file-powerpoint&quot;," />
      <LineAnalysis line="535" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            &quot;text/plain&quot; =&gt; &quot;fa-solid fa-file-lines&quot;," />
      <LineAnalysis line="536" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            &quot;text/markdown&quot; =&gt; &quot;fa-solid fa-file-lines&quot;," />
      <LineAnalysis line="537" visits="3" coverage="Covered" coveredbranches="2" totalbranches="2" content="            string ct when ct.StartsWith(&quot;image/&quot;) =&gt; &quot;fa-solid fa-file-image&quot;," />
      <LineAnalysis line="538" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="            _ =&gt; &quot;fa-solid fa-file&quot;" />
      <LineAnalysis line="539" visits="9" coverage="Covered" coveredbranches="" totalbranches="" content="        };" />
      <LineAnalysis line="540" visits="9" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="541" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="}" />
    </File>
  </Files>
</CoverageReport>