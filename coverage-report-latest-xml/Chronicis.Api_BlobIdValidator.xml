<?xml version="1.0" encoding="utf-8"?>
<CoverageReport scope="Chronicis.Api.Services.ExternalLinks.BlobIdValidator">
  <Summary>
    <Class>Chronicis.Api.Services.ExternalLinks.BlobIdValidator</Class>
    <Assembly>Chronicis.Api</Assembly>
    <Files>
      <File>Z:\repos\chronicis\src\Chronicis.Api\Services\ExternalLinks\BlobIdValidator.cs</File>
    </Files>
    <Coveredlines>29</Coveredlines>
    <Uncoveredlines>0</Uncoveredlines>
    <Coverablelines>29</Coverablelines>
    <Totallines>85</Totallines>
    <Linecoverage>100</Linecoverage>
    <Coveredbranches>12</Coveredbranches>
    <Totalbranches>12</Totalbranches>
    <Branchcoverage>100</Branchcoverage>
    <Coveredmethods>3</Coveredmethods>
    <Fullcoveredmethods>3</Fullcoveredmethods>
    <Totalmethods>3</Totalmethods>
    <Methodcoverage>100</Methodcoverage>
    <Fullmethodcoverage>100</Fullmethodcoverage>
  </Summary>
  <Metrics>
    <Element name="cctor">
      <CrapScore>1</CrapScore>
      <Cyclomaticcomplexity>1</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="IsValid">
      <CrapScore>6</CrapScore>
      <Cyclomaticcomplexity>6</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
    <Element name="ParseId">
      <CrapScore>6</CrapScore>
      <Cyclomaticcomplexity>6</Cyclomaticcomplexity>
      <Linecoverage>100</Linecoverage>
      <Branchcoverage>100</Branchcoverage>
    </Element>
  </Metrics>
  <Files>
    <File name="Z:\repos\chronicis\src\Chronicis.Api\Services\ExternalLinks\BlobIdValidator.cs">
      <LineAnalysis line="1" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="using System.Text.RegularExpressions;" />
      <LineAnalysis line="2" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="3" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="namespace Chronicis.Api.Services.ExternalLinks;" />
      <LineAnalysis line="4" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="5" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="/// &lt;summary&gt;" />
      <LineAnalysis line="6" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="/// Validates and parses blob-based external link IDs." />
      <LineAnalysis line="7" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="/// Security: Prevents path traversal and injection attacks." />
      <LineAnalysis line="8" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="/// Supports hierarchical IDs like &quot;items/armor/breastplate&quot; for subcategories." />
      <LineAnalysis line="9" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="/// &lt;/summary&gt;" />
      <LineAnalysis line="10" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="public static partial class BlobIdValidator" />
      <LineAnalysis line="11" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="{" />
      <LineAnalysis line="12" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    // ID must be: alphanumeric + hyphens (case-insensitive), one or more slashes" />
      <LineAnalysis line="13" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    // Format: &quot;category/slug&quot; OR &quot;category/subcategory/slug&quot;" />
      <LineAnalysis line="14" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    // Examples: &quot;spells/fireball&quot;, &quot;items/armor/breastplate&quot;, &quot;bestiary/Beast/aboar&quot;" />
      <LineAnalysis line="15" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    [GeneratedRegex(@&quot;^[a-zA-Z0-9-]+(/[a-zA-Z0-9-]+)+$&quot;, RegexOptions.Compiled)]" />
      <LineAnalysis line="16" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    private static partial Regex ValidIdPattern();" />
      <LineAnalysis line="17" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="18" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    // Characters that are prohibited in IDs (security)" />
      <LineAnalysis line="19" visits="1" coverage="Covered" coveredbranches="" totalbranches="" content="    private static readonly char[] ProhibitedChars = { '.', '\\', '[', ']', '|' };" />
      <LineAnalysis line="20" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="21" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;summary&gt;" />
      <LineAnalysis line="22" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// Validates an external link ID against security rules." />
      <LineAnalysis line="23" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// Supports hierarchical paths with multiple slashes (e.g., &quot;items/armor/breastplate&quot;)." />
      <LineAnalysis line="24" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;/summary&gt;" />
      <LineAnalysis line="25" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;param name=&quot;id&quot;&gt;ID to validate.&lt;/param&gt;" />
      <LineAnalysis line="26" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;param name=&quot;error&quot;&gt;Error message if validation fails.&lt;/param&gt;" />
      <LineAnalysis line="27" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;returns&gt;True if valid, false otherwise.&lt;/returns&gt;" />
      <LineAnalysis line="28" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    public static bool IsValid(string id, out string? error)" />
      <LineAnalysis line="29" visits="17" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="30" visits="17" coverage="Covered" coveredbranches="" totalbranches="" content="        error = null;" />
      <LineAnalysis line="31" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="32" visits="17" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (string.IsNullOrWhiteSpace(id))" />
      <LineAnalysis line="33" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="34" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            error = &quot;ID cannot be empty&quot;;" />
      <LineAnalysis line="35" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            return false;" />
      <LineAnalysis line="36" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="37" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="38" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Check for prohibited characters (path traversal, injection attempts)" />
      <LineAnalysis line="39" visits="14" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (id.IndexOfAny(ProhibitedChars) &gt;= 0)" />
      <LineAnalysis line="40" visits="7" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="41" visits="7" coverage="Covered" coveredbranches="" totalbranches="" content="            error = &quot;ID contains prohibited characters (. \\ [ ] |)&quot;;" />
      <LineAnalysis line="42" visits="7" coverage="Covered" coveredbranches="" totalbranches="" content="            return false;" />
      <LineAnalysis line="43" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="44" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="45" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        // Validate format: lowercase alphanumeric + hyphens with at least one slash" />
      <LineAnalysis line="46" visits="7" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (!ValidIdPattern().IsMatch(id))" />
      <LineAnalysis line="47" visits="4" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="48" visits="4" coverage="Covered" coveredbranches="" totalbranches="" content="            error = &quot;ID must have format 'category/slug' or 'category/subcategory/slug' with alphanumeric and hyphens only&quot;;" />
      <LineAnalysis line="49" visits="4" coverage="Covered" coveredbranches="" totalbranches="" content="            return false;" />
      <LineAnalysis line="50" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="51" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="52" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="        return true;" />
      <LineAnalysis line="53" visits="17" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="54" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="55" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;summary&gt;" />
      <LineAnalysis line="56" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// Parses a validated ID into category path and slug components." />
      <LineAnalysis line="57" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// For hierarchical IDs, category includes all path segments except the last." />
      <LineAnalysis line="58" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;/summary&gt;" />
      <LineAnalysis line="59" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;param name=&quot;id&quot;&gt;ID to parse (e.g., &quot;spells/fireball&quot; or &quot;items/armor/breastplate&quot;).&lt;/param&gt;" />
      <LineAnalysis line="60" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;returns&gt;" />
      <LineAnalysis line="61" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// Tuple of (categoryPath, slug):" />
      <LineAnalysis line="62" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// - &quot;spells/fireball&quot; -&gt; (&quot;spells&quot;, &quot;fireball&quot;)" />
      <LineAnalysis line="63" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// - &quot;items/armor/breastplate&quot; -&gt; (&quot;items/armor&quot;, &quot;breastplate&quot;)" />
      <LineAnalysis line="64" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// Returns (null, null) if invalid format." />
      <LineAnalysis line="65" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    /// &lt;/returns&gt;" />
      <LineAnalysis line="66" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="    public static (string? categoryPath, string? slug) ParseId(string id)" />
      <LineAnalysis line="67" visits="7" coverage="Covered" coveredbranches="" totalbranches="" content="    {" />
      <LineAnalysis line="68" visits="7" coverage="Covered" coveredbranches="2" totalbranches="2" content="        if (string.IsNullOrWhiteSpace(id))" />
      <LineAnalysis line="69" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="70" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="            return (null, null);" />
      <LineAnalysis line="71" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="72" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="73" visits="5" coverage="Covered" coveredbranches="" totalbranches="" content="        var lastSlashIndex = id.LastIndexOf('/');" />
      <LineAnalysis line="74" visits="5" coverage="Covered" coveredbranches="4" totalbranches="4" content="        if (lastSlashIndex &lt;= 0 || lastSlashIndex &gt;= id.Length - 1)" />
      <LineAnalysis line="75" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="        {" />
      <LineAnalysis line="76" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="            // No slash, or slash at start/end" />
      <LineAnalysis line="77" visits="3" coverage="Covered" coveredbranches="" totalbranches="" content="            return (null, null);" />
      <LineAnalysis line="78" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="        }" />
      <LineAnalysis line="79" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="80" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        var categoryPath = id[..lastSlashIndex];" />
      <LineAnalysis line="81" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        var slug = id[(lastSlashIndex + 1)..];" />
      <LineAnalysis line="82" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="" />
      <LineAnalysis line="83" visits="2" coverage="Covered" coveredbranches="" totalbranches="" content="        return (categoryPath, slug);" />
      <LineAnalysis line="84" visits="7" coverage="Covered" coveredbranches="" totalbranches="" content="    }" />
      <LineAnalysis line="85" visits="-1" coverage="NotCoverable" coveredbranches="" totalbranches="" content="}" />
    </File>
  </Files>
</CoverageReport>