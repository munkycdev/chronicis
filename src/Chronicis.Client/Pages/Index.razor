@page "/"
@inject ITreeStateService TreeStateService
@inject IArticleApiService ArticleApiService
@implements IDisposable

<PageTitle>Chronicis</PageTitle>

@if (TreeStateService.SelectedArticleId.HasValue)
{
    <ArticleDetail />
}
else
{
    <div class="chronicis-welcome">
        <h1>Welcome to Chronicis</h1>
        <p>Select an article from the tree to view it.</p>
    </div>
}

@code
{
    protected override async Task OnInitializedAsync()
    {
        var rootArticles = await ArticleApiService.GetRootArticlesAsync();
        TreeStateService.Initialize(rootArticles);
        TreeStateService.OnStateChanged += OnTreeStateChanged;
    }

    private void OnTreeStateChanged()
    {
        StateHasChanged();  // Just trigger re-render, ArticleDetail handles the rest
    }

    public void Dispose()
    {
        TreeStateService.OnStateChanged -= OnTreeStateChanged;
    }
}